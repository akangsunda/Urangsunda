<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Aksara Sunda - Full Ngalagena & Rarangken</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #6c5ce7; --secondary: #a29bfe; --danger: #ff7675; --success: #55efc4; --gold: #f1c40f; }
        body { font-family: 'Segoe UI', sans-serif; background: #dfe6e9; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; flex-direction: column; overflow-x: hidden; }
        
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: flex; justify-content: center; align-items: center; z-index: 100; animation: fadeIn 0.5s; }
        #modal-ranking { display: none; background: rgba(45, 52, 54, 0.98); z-index: 200; flex-direction: column; }
        .modal-content { background: white; padding: 30px; border-radius: 25px; text-align: center; width: 280px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        
        .game-container { background: white; padding: 25px; border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); text-align: center; width: 340px; position: relative; border: 4px solid white; }
        
        .header-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .badge { background: #2d3436; color: white; padding: 6px 14px; border-radius: 20px; font-size: 11px; font-weight: bold; }
        
        .timer-bar { width: 100%; height: 10px; background: #eee; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        #timer-fill { width: 100%; height: 100%; background: linear-gradient(90deg, var(--secondary), var(--primary)); transition: width 0.1s linear; }

        .question-label { font-size: 12px; color: #636e72; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; }
        .aksara-display { font-size: 50px; margin: 10px 0; color: #2d3436; min-height: 120px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border-radius: 20px; padding: 10px; border: 2px dashed #dfe6e9; transition: all 0.3s; }
        
        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        button { padding: 15px 10px; font-size: 18px; cursor: pointer; border: 2px solid #f0f0f0; background: white; border-radius: 15px; transition: 0.3s; font-weight: bold; color: #2d3436; box-shadow: 0 4px 0 #eee; }
        button:active { transform: translateY(3px); box-shadow: none; }
        button:hover { border-color: var(--primary); color: var(--primary); }

        .ranking-section { margin-top: 25px; padding: 15px; background: #fcfcfc; border-radius: 20px; border: 1px solid #eee; }
        .ranking-title { font-weight: 800; font-size: 12px; color: var(--primary); margin-bottom: 10px; letter-spacing: 1px; animation: glowText 2s infinite alternate; }
        .ranking-item { display: flex; justify-content: space-between; padding: 6px 0; font-size: 13px; border-bottom: 1px solid #f1f1f1; }
        
        #goal-notification { margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #fff9db, #fff3bf); border: 1px solid var(--gold); border-radius: 15px; font-size: 12px; color: #856404; font-weight: 800; box-shadow: 0 4px 15px rgba(241, 196, 15, 0.2); }

        @keyframes glowText { from { text-shadow: 0 0 2px #fff, 0 0 5px var(--secondary); } to { text-shadow: 0 0 5px #fff, 0 0 15px var(--primary); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div id="name-modal" class="modal">
    <div class="modal-content">
        <h2 style="color:var(--primary); margin:0">AKSARA GLOBAL</h2>
        <p style="font-size:14px; color:#636e72">Masukkan Nama Anda:</p>
        <input type="text" id="player-name-input" placeholder="Nami..." maxlength="12">
        <button onclick="savePlayerName()" style="width: 100%; background: var(--primary); color: white; border: none; padding: 15px; border-radius: 15px; box-shadow: 0 4px 0 #5849c4;">MULAI MA√âN</button>
    </div>
</div>

<div id="modal-ranking" class="modal">
    <h2 id="final-status" style="color:white; font-size:32px;">SKOR: 0</h2>
    <div class="modal-content">
        <h3 style="color:var(--primary); margin-top:0">üåé TOP GLOBAL</h3>
        <ul id="final-ranking-list" style="list-style:none; padding:0; margin:0; text-align:left;"></ul>
        <button onclick="location.reload()" style="width:100%; margin-top:20px; background:var(--success); color:white; border:none; padding:15px; border-radius:15px; font-weight:bold; box-shadow: 0 4px 0 #2ecc71;">MA√âN DEUI</button>
    </div>
</div>

<div class="game-container">
    <div class="header-info">
        <span class="badge" id="player-tag">PLAYER</span>
        <span id="lives" style="font-size:18px;">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
        <span class="badge" style="background:var(--primary)">SKOR: <span id="score">0</span></span>
    </div>
    <div class="timer-bar"><div id="timer-fill"></div></div>
    <div class="question-label" id="q-label">Pilih Hartosna:</div>
    <div class="aksara-display" id="aksara-char">--</div>
    <div class="options" id="options-container"></div>
    
    <div class="ranking-section">
        <div class="ranking-title">üåé TOP 5 GLOBAL SCORE</div>
        <ul id="ranking-list" style="list-style:none; padding:0; margin:0"></ul>
    </div>
    
    <div id="goal-notification">üëë GLOBAL TOP: <span id="top-scorer">Loading...</span></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDlDickeQyYgQayXSMe3gtV6_2YHT7q5bw",
        authDomain: "sundaapp-2d378.firebaseapp.com",
        databaseURL: "https://sundaapp-2d378-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "sundaapp-2d378",
        storageBucket: "sundaapp-2d378.firebasestorage.app",
        messagingSenderId: "139039839460",
        appId: "1:139039839460:web:6fe18cdf9fc0b1030cc8f1"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // GENERATOR DATABASE AKSARA + RARANGKEN
    function generateDatabase() {
        const ngalagena = [
            {c:'·Æä', a:'Ka'}, {c:'·Æå', a:'Ga'}, {c:'·Æç', a:'Nga'}, {c:'·Æé', a:'Ca'}, {c:'·Æè', a:'Ja'},
            {c:'·Æë', a:'Nya'}, {c:'·Æí', a:'Ta'}, {c:'·Æì', a:'Da'}, {c:'·Æî', a:'Na'}, {c:'·Æï', a:'Pa'},
            {c:'·Æò', a:'Ba'}, {c:'·Æô', a:'Ma'}, {c:'·Æö', a:'Ya'}, {c:'·Æõ', a:'Ra'}, {c:'·Æú', a:'La'},
            {c:'·Æù', a:'Wa'}, {c:'·Æû', a:'Sa'}, {c:'·Æ†', a:'Ha'}, {c:'·Æñ', a:'Fa'}, {c:'·Æó', a:'Va'},
            {c:'·Æã', a:'Qa'}, {c:'·Æü', a:'Xa'}, {c:'·Æê', a:'Za'}, {c:'·ÆÆ', a:'Kha'}, {c:'·ÆØ', a:'Sha'}
        ];
        const rarangken = [
            {c:'·Æ§', a:'i'}, {c:'·Æ•', a:'u'}, {c:'·Æ¶', a:'√©'}, {c:'·Æß', a:'o'}, {c:'·Æ©', a:'eu'}, {c:'·Æ®', a:'e'}
        ];
        
        let fullData = [];
        ngalagena.forEach(item => {
            fullData.push({ c: item.c, a: item.a }); // Dasar (Ka)
            rarangken.forEach(r => {
                fullData.push({ 
                    c: item.c + r.c, 
                    a: item.a.replace('a', r.a) 
                }); // Kombinasi (Ki, Ku, Ke, Ko...)
            });
        });
        return fullData;
    }

    const dataAksara = generateDatabase();
    let score = 0, lives = 3, level = 1, timeLeft = 100, timerId = null, currentQ = {}, playerName = "", isLatenQuestion = false;

    function savePlayerName() {
        const input = document.getElementById('player-name-input').value;
        playerName = input.trim() || "Pama√©n";
        document.getElementById('player-tag').innerText = playerName.toUpperCase();
        document.getElementById('name-modal').style.display = 'none';
        listenGlobalRanking();
        startGame();
    }

    function startGame() { updateStats(); nextQuestion(); }

    function nextQuestion() {
        clearInterval(timerId); timeLeft = 100;
        currentQ = dataAksara[Math.floor(Math.random() * dataAksara.length)];
        isLatenQuestion = Math.random() > 0.5;
        
        const display = document.getElementById('aksara-char');
        const label = document.getElementById('q-label');
        
        if (isLatenQuestion) {
            display.innerText = currentQ.a;
            label.innerText = "Mana Aksara Sundana?";
            display.style.fontSize = "35px";
        } else {
            display.innerText = currentQ.c;
            label.innerText = "Pilih Hartosna:";
            display.style.fontSize = "50px";
        }

        // Rocket speed henteu gancang teuing [cite: 2026-02-08]
        let speed = Math.max(70, 140 - (level * 5)); 
        timerId = setInterval(() => {
            timeLeft -= 0.5;
            document.getElementById('timer-fill').style.width = timeLeft + "%";
            if (timeLeft <= 0) handleResult(false);
        }, speed);
        generateOptions();
    }

    function generateOptions() {
        let correctValue = isLatenQuestion ? currentQ.c : currentQ.a;
        let choices = [correctValue];
        while (choices.length < 4) {
            let rand = dataAksara[Math.floor(Math.random() * dataAksara.length)];
            let val = isLatenQuestion ? rand.c : rand.a;
            if (!choices.includes(val)) choices.push(val);
        }
        choices.sort(() => Math.random() - 0.5);
        const container = document.getElementById('options-container');
        container.innerHTML = '';
        choices.forEach(c => {
            const btn = document.createElement('button');
            btn.innerText = c;
            if (isLatenQuestion) btn.style.fontSize = "22px";
            btn.onclick = () => handleResult(c === correctValue);
            container.appendChild(btn);
        });
    }

    function handleResult(isCorrect) {
        clearInterval(timerId);
        if (isCorrect) {
            score += 15; level = Math.floor(score / 100) + 1;
            nextQuestion();
        } else {
            lives--;
            if (lives > 0) nextQuestion();
            else endGame();
        }
        updateStats();
    }

    function endGame() {
        clearInterval(timerId);
        db.ref('global_ranking').push({ name: playerName, score: score, ts: Date.now() });
        document.getElementById('modal-ranking').style.display = 'flex';
        document.getElementById('final-status').innerText = "SKOR: " + score;
        db.ref('global_ranking').orderByChild('score').limitToLast(5).once('value', (snap) => {
            const list = document.getElementById('final-ranking-list');
            list.innerHTML = "";
            let data = [];
            snap.forEach(c => { data.push(c.val()); });
            data.reverse().forEach((r, i) => {
                list.innerHTML += `<li style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #eee; font-weight:bold">
                    <span>${i+1}. ${r.name}</span><span style="color:var(--primary)">${r.score}</span></li>`;
            });
        });
    }

    function updateStats() {
        document.getElementById('score').innerText = score;
        document.getElementById('lives').innerText = "‚ù§Ô∏è".repeat(lives);
    }

    function listenGlobalRanking() {
        db.ref('global_ranking').orderByChild('score').limitToLast(5).on('value', (snap) => {
            const list = document.getElementById('ranking-list');
            list.innerHTML = "";
            let data = [];
            snap.forEach(c => { data.push(c.val()); });
            data.reverse().forEach((r, i) => {
                list.innerHTML += `<li class="ranking-item"><span>${i+1}. ${r.name}</span><b>${r.score}</b></li>`;
                if(i === 0) document.getElementById('top-scorer').innerText = `${r.name.toUpperCase()} (${r.score})`;
            });
        });
    }
</script>
</body>
</html>
