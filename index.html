<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Aksara Sunda - Rules Global</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #6c5ce7; --secondary: #a29bfe; --danger: #ff7675; --success: #55efc4; }
        body { font-family: 'Segoe UI', sans-serif; background: #dfe6e9; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; flex-direction: column; }
        #name-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: flex; justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background: white; padding: 30px; border-radius: 20px; text-align: center; width: 280px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        input { width: 85%; padding: 12px; margin: 15px 0; border-radius: 10px; border: 2px solid #eee; text-align: center; font-size: 16px; outline: none; }
        .game-container { background: white; padding: 25px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.15); text-align: center; width: 340px; position: relative; }
        .timer-bar { width: 100%; height: 12px; background: #eee; border-radius: 6px; margin-bottom: 15px; overflow: hidden; }
        #timer-fill { width: 100%; height: 100%; background: linear-gradient(to right, var(--secondary), var(--primary)); transition: width 0.1s linear; }
        .header-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-weight: bold; }
        .badge { background: #2d3436; color: white; padding: 5px 12px; border-radius: 15px; font-size: 11px; }
        .aksara-display { font-size: 55px; margin: 15px 0; color: #2d3436; min-height: 140px; display: flex; align-items: center; justify-content: center; word-break: break-all; padding: 10px; line-height: 1.2; }
        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { padding: 14px 8px; font-size: 14px; cursor: pointer; border: 2px solid #f0f0f0; background: #f9f9f9; border-radius: 12px; transition: 0.2s; font-weight: bold; color: #444; }
        button:hover { background: var(--primary); color: white; transform: translateY(-2px); }
        .ranking-section { margin-top: 20px; padding-top: 15px; border-top: 1px dashed #ccc; font-size: 13px; text-align: left; }
        .ranking-item { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #f8f8f8; }
        #goal-notification { margin-top: 15px; padding: 10px; background: #fff9db; border: 1px solid #fab005; border-radius: 10px; font-size: 12px; color: #856404; font-weight: bold; }
        .brand { font-size: 9px; color: #b2bec3; margin-top: 15px; font-weight: bold; letter-spacing: 1px; }
    </style>
</head>
<body>

<div id="name-modal">
    <div class="modal-content">
        <h2 style="margin-top:0; color:var(--primary)">Rules Global</h2>
        <p style="font-size:14px; color:#666">Wilujeng Sumping!<br>Masukkan Nama Kamu:</p>
        <input type="text" id="player-name-input" placeholder="Nami..." maxlength="12">
        <button onclick="savePlayerName()" style="width: 100%; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 10px; font-weight:bold; cursor:pointer;">GASKEUN!</button>
    </div>
</div>

<div class="game-container">
    <div class="header-info">
        <span class="badge" id="player-tag">PLAYER</span>
        <span id="lives">тЭдя╕ПтЭдя╕ПтЭдя╕П</span>
        <span class="badge">SKOR: <span id="score">0</span></span>
    </div>
    <div class="timer-bar"><div id="timer-fill"></div></div>
    <div class="aksara-display" id="aksara-char">--</div>
    <div class="options" id="options-container"></div>
    <div id="message" style="margin-top:12px; font-weight:bold; height:20px; font-size:13px; text-align:center;"></div>
    <div class="ranking-section">
        <div style="text-align:center; font-weight:bold; margin-bottom:8px; color:var(--primary)">ЁЯМО TOP 5 GLOBAL SCORE</div>
        <ul id="ranking-list" style="list-style:none; padding:0; margin:0"></ul>
    </div>
    <div id="goal-notification">ЁЯСС GLOBAL TOP: <span id="top-scorer">Loading...</span></div>
    <div class="brand">BRAND: RULES | TIKTOK: MARQQUAN</div>
</div>

<script>
    // Konfigurasi Firebase Sundaapp anjeun
    const firebaseConfig = {
        apiKey: "AIzaSyDlDickeQyYgQayXSMe3gtV6_2YHT7q5bw",
        authDomain: "sundaapp-2d378.firebaseapp.com",
        projectId: "sundaapp-2d378",
        storageBucket: "sundaapp-2d378.firebasestorage.app",
        messagingSenderId: "139039839460",
        appId: "1:139039839460:web:6fe18cdf9fc0b1030cc8f1"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const database = {
        dasar: [
            { c: 'соКсод', a: 'Ki' }, { c: 'соКсое', a: 'Ku' }, { c: 'соЬсод', a: 'Li' }, { c: 'соЬсое', a: 'Lu' },
            { c: 'соЭсод', a: 'Wi' }, { c: 'соЭсое', a: 'Wu' }, { c: 'соПсод', a: 'Ji' }, { c: 'соПсое', a: 'Ju' },
            { c: 'соЩсод', a: 'Mi' }, { c: 'соЩсое', a: 'Mu' }, { c: 'соФсод', a: 'Ni' }, { c: 'соФсое', a: 'Nu' },
            { c: 'соМсод', a: 'Gi' }, { c: 'соМсое', a: 'Gu' }, { c: 'соЬсой', a: 'Leu' }, { c: 'соЬсож', a: 'L├и' }
        ],
        kecap: [
            { c: 'соГсоШсоВ', a: 'Abah' }, { c: 'соЭсоУсоасок', a: 'Wadah' }, { c: 'соЬсозсоУсозсоА', a: 'Lodong' },
            { c: 'соОсоЫсойсоасок', a: 'Careuh' }, { c: 'соКсоЬсоАсоКсоА', a: 'Kalangkang' }, { c: 'соНсоСсоЩсок', a: 'Nganyam' },
            { c: 'соГсоШсоксоУсод соТсожсоасок соШсодсоЮ соУсодсоГсоПсоБ соГсоКсоксоЮсоЫ соЮсоесоФсоксоУ', a: 'Abdi t├иh bisa diajar aksara sunda' }
        ]
    };

    let score = 0, lives = 3, level = 1, timeLeft = 100, timerId = null, currentQ = {}, playerName = "";

    function savePlayerName() {
        const input = document.getElementById('player-name-input').value;
        playerName = input.trim() || "Baraya";
        document.getElementById('player-tag').innerText = playerName.toUpperCase();
        document.getElementById('name-modal').style.display = 'none';
        listenGlobalRanking();
        startGame();
    }

    function startGame() { updateStats(); nextQuestion(); }

    function nextQuestion() {
        clearInterval(timerId); timeLeft = 100;
        let pool = level < 3 ? [...database.dasar] : [...database.kecap];
        currentQ = pool[Math.floor(Math.random() * pool.length)];
        const display = document.getElementById('aksara-char');
        display.innerText = currentQ.c;
        display.style.fontSize = currentQ.c.length > 15 ? "18px" : (currentQ.c.length > 5 ? "32px" : "55px");
        let speed = Math.max(50, 130 - (level * 5));
        timerId = setInterval(() => {
            timeLeft -= 0.5;
            document.getElementById('timer-fill').style.width = timeLeft + "%";
            if (timeLeft <= 0) handleResult(false);
        }, speed);
        generateOptions(currentQ.a, pool);
    }

    function generateOptions(correct, pool) {
        let choices = [correct];
        while (choices.length < 4) {
            let rand = pool[Math.floor(Math.random() * pool.length)].a;
            if (!choices.includes(rand)) choices.push(rand);
        }
        choices.sort(() => Math.random() - 0.5);
        const container = document.getElementById('options-container');
        container.innerHTML = '';
        choices.forEach(c => {
            const btn = document.createElement('button');
            btn.innerText = c;
            btn.onclick = () => handleResult(c === correct);
            container.appendChild(btn);
        });
    }

    function handleResult(isCorrect) {
        clearInterval(timerId);
        if (isCorrect) {
            score += 15; level = Math.floor(score / 75) + 1;
            nextQuestion();
        } else {
            lives--;
            if (lives > 0) nextQuestion();
            else endGame();
        }
        updateStats();
    }

    function endGame() {
        db.ref('global_ranking').push({ name: playerName, score: score, ts: Date.now() });
        alert("GAME OVER! Skor Global anjeun: " + score);
        location.reload();
    }

    function updateStats() {
        document.getElementById('score').innerText = score;
        document.getElementById('lives').innerText = "тЭдя╕П".repeat(lives);
    }

    function listenGlobalRanking() {
        db.ref('global_ranking').orderByChild('score').limitToLast(5).on('value', (snap) => {
            const list = document.getElementById('ranking-list');
            list.innerHTML = "";
            let data = [];
            snap.forEach(c => { data.push(c.val()); });
            data.reverse().forEach((r, i) => {
                list.innerHTML += `<li class="ranking-item"><span>${i+1}. ${r.name}</span><b>${r.score}</b></li>`;
                if(i === 0) document.getElementById('top-scorer').innerText = `${r.name.toUpperCase()} (${r.score})`;
            });
        });
    }
</script>
</body>
</html>
